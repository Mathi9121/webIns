{% extends '::app.html.twig' %}

{% block stylesheets %}
{{ parent() }}
	{% stylesheets 
		'@OCIMFormationsBundle/Resources/public/css/inscriptions.css'
	filter='cssrewrite' %}
		<link rel="stylesheet" type="text/css" charset="UTF-8" media="all" href="{{ asset_url }}"/>
	{% endstylesheets %}
{% endblock %}

{# {% block  javascripts %}
{{parent()}}
{% javascripts
	'@OCIMFormationsBundle/Resources/public/js/Inscription/inscription.js'
	%}
         <script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
{% endblock %} #}



{% block title %}Inscriptions pour {% endblock %}
{% block titre %}{{ formation.intitule }}{% endblock %}
{% block controls %}<a href="{{ path('inscription_new', { 'idformation': formation.id }) }}" class="btn btn-green"><span class="oi" data-glyph="plus"></span> Nouvelle inscription</a>{% endblock %}

{% block body -%}
{% if entities != null %}
<nav class="nav-tabs" data-tools="tabs" data-equals="true">
	<ul>
		<li class="active"><a href="#general">Informations Générales</a></li>
		<li><a href="#contact">Contacts</a></li>
		<li><a href="#convention">Conventions</a></li>
		<li><a href="#attentes">Attentes</a></li>
	</ul>
</nav>

{# GENERAL #}
<div id="general">
<div class="table-container">
	<table class="table-hovered">
		<thead>
			<tr>
				<th class="statut"></th>
				<th class="insc info"><span>Nom</span></th>
				<th class="insc info"><span>Prénom</span></th>
				<th class="insc info"><span>Formule</span></th>
				<th class="insc info"><span>Fonction</span></th>
				<th class="insc info"><span>Inscription le</span></th>
				<th class="insc info"><span>Statut Financement</span></th>
				<th class="insc info"><span>Statut Convention</span></th>
				<th></th>
			</tr>
		</thead>
		<tbody>
        {% for entity in entities %}
            <tr>
				{% set class = "" %}
				{% if entity.statut == 'en attente' %}
					{% set class = "attente" %}
				{% elseif entity.statut == 'accepté' %}
					{% set class = "valide" %}
				{% elseif entity.statut == 'annulé' %}
					{% set class = "annule" %}
				{% endif %}
				<td class="statut {{class}}">&nbsp;</td>
				
				{% for personne in entity.personnes %}
					{% if personne.type == 'Stagiaire' %}
						<td class="insc info"><span>{{ personne.nom }} ({{ personne.civilite }})</span></td>
						<td class="insc info"><span>{{ personne.prenom }}</span></td>
						<td class="insc info"><span><abbr title="{{ entity.formationFormule.formule }}">{{ entity.formationFormule.formule.id }}</abbr></span></td>
						<td class="insc info"><span>{{ personne.fonction }}</span></td>
						<td class="insc info"><span>{% if entity.dateInscription %}{{ entity.dateInscription|date('d/m/Y') }}{% endif %}</span></td>
						<td class="insc info"><span>{{ entity.statutOrgFinanceur }}</span></td>
						<td class="insc info"><span>{{ entity.statutConvention }}</span></td>
					{% endif %}
				{% endfor %}
                <td class="insc actions">
						<a href="{{ path('inscription_show', { 'id': entity.id, 'idformation':formation.id }) }}">show</a>
						<a href="{{ path('inscription_edit', { 'id': entity.id, 'idformation':formation.id }) }}">edit</a>
				</td>
            </tr>
        {% endfor %}
        </tbody>
	</table>
</div>
</div>

{# CONTACT #}
<div id="contact">
<div class="table-container">
	<table class="table-hovered">
		<thead>
			<tr>
				<th class="statut"></th>
				<th class="insc info"><span>Nom</span></th>
				<th class="insc info"><span>Prénom</span></th>
				<th class="insc contact"><span>Tel</span></th>
				<th class="insc contact"><span>Fax</span></th>
				<th class="insc contact"><span>Mail</span></th>
				<th class="insc contact"><span>Mail Admin</span></th>
				<th class="insc contact"><span>Structure</span></th>
				<th class="insc contact"><span>Adresse</span></th>
				<th class="insc contact"><span>Complément</span></th>
				<th class="insc contact"><span>Code postal</span></th>
				<th class="insc contact"><span>Ville</span></th>
				<th class="insc contact"><span>Pays</span></th>
				<th></th>
			</tr>
		</thead>
		<tbody>
        {% for entity in entities %}
            <tr>
				{% set class = "" %}
				{% if entity.statut == 'en attente' %}
					{% set class = "attente" %}
				{% elseif entity.statut == 'accepté' %}
					{% set class = "valide" %}
				{% elseif entity.statut == 'annulé' %}
					{% set class = "annule" %}
				{% endif %}
				<td class="statut {{class}}">&nbsp;</td>
				
				{% for personne in entity.personnes %}
					{% if personne.type == 'Stagiaire' %}
						<td class="insc info"><span>{{ personne.nom }} ({{ personne.civilite }})</span></td>
						<td class="insc info"><span>{{ personne.prenom }}</span></td>
						
						<td class="insc contact"><span>{{ personne.tel }}</span></td>
						<td class="insc contact"><span>{{ personne.fax}}</span></td>
						<td class="insc contact"><span>{{ personne.mail}}</span></td>
						<td class="insc contact"><span>{{ personne.mailAdmin}}</span></td>
					{% endif %}
					{% if personne.adresse %}
						<td class="insc contact"><span>{{ personne.adresse.nomStructure }}</span></td>
						<td class="insc contact"><span>{{ personne.adresse.adresse }}</span></td>
						<td class="insc contact"><span>{{ personne.adresse.adresseComplement }}</span></td>
						<td class="insc contact"><span>{{ personne.adresse.CP }}</span></td>
						<td class="insc contact"><span>{{ personne.adresse.ville }}</span></td>
						<td class="insc contact"><span>{{ personne.adresse.pays }}</span></td>
					{% else %}
						<td class="insc contact"><span></span></td>
						<td class="insc contact"><span></span></td>
						<td class="insc contact"><span></span></td>
						<td class="insc contact"><span></span></td>
						<td class="insc contact"><span></span></td>
						<td class="insc contact"><span></span></td>
					{% endif %}
				{% endfor %}
                <td class="insc actions">
						<a href="{{ path('inscription_show', { 'id': entity.id, 'idformation':formation.id }) }}">show</a>
						<a href="{{ path('inscription_edit', { 'id': entity.id, 'idformation':formation.id }) }}">edit</a>
				</td>
            </tr>
        {% endfor %}
        </tbody>
	</table>
</div>
</div>

{# CONVENTION #}
<div id="convention">
<div class="table-container">
	<table class="table-hovered">
		<thead>
			<tr>
				<th class="statut"></th>
				<th class="insc info"><span>Nom</span></th>
				<th class="insc info"><span>Prénom</span></th>
				<th class="insc convention"><span>Numéro</span></th>
				<th class="insc convention"><span>Edition</span></th>
				<th class="insc convention"><span>Envoi Président 2 ex</span></th>
				<th class="insc convention"><span>Retour Président 2 ex</span></th>
				<th class="insc convention"><span>Envoi organisme 2 ex</span></th>
				<th class="insc convention"><span>Retour organisme 1 ex</span></th>
				<th class="insc convention"><span>Envoi Président 1 ex</span></th>
				<th></th>
			</tr>
		</thead>
		<tbody>
        {% for entity in entities %}
            <tr>
				{% set class = "" %}
				{% if entity.statut == 'en attente' %}
					{% set class = "attente" %}
				{% elseif entity.statut == 'accepté' %}
					{% set class = "valide" %}
				{% elseif entity.statut == 'annulé' %}
					{% set class = "annule" %}
				{% endif %}
				<td class="statut {{class}}">&nbsp;</td>
				
				{% for personne in entity.personnes %}
						{% if personne.type == 'Stagiaire' %}
							<td class="insc info"><span>{{ personne.nom }} ({{ personne.civilite }})</span></td>
							<td class="insc info"><span>{{ personne.prenom }}</span></td>
						{% endif %}
					{% if entity.convention %}
						<td class="insc convention"><span>{{ entity.convention.numero }}</span></td>
						<td class="insc convention"><span>{{ entity.convention.edition|date('d/m/Y') }}</span></td>
						<td class="insc convention"><span>{{ entity.convention.envoiPresidentU2ex|date('d/m/Y') }}</span></td>
						<td class="insc convention"><span>{{ entity.convention.retourPresidentU2ex|date('d/m/Y')}}</span></td>
						<td class="insc convention"><span>{{ entity.convention.envoiOrganisme2ex|date('d/m/Y') }}</span></td>
						<td class="insc convention"><span>{{ entity.convention.retourOrganisme1ex|date('d/m/Y') }}</span></td>
						<td class="insc convention"><span>{{ entity.convention.envoiPresidentU1ex|date('d/m/Y')}}</span></td>
					{% else %}
						<td class="insc convention"><span></span></td>
						<td class="insc convention"><span></span></td>
						<td class="insc convention"><span></span></td>
						<td class="insc convention"><span></span></td>
						<td class="insc convention"><span></span></td>
						<td class="insc convention"><span></span></td>
						<td class="insc convention"><span></span></td>
					{% endif %}
				{% endfor %}
                <td class="insc actions">
						<a href="{{ path('inscription_show', { 'id': entity.id, 'idformation':formation.id }) }}">show</a>
						<a href="{{ path('inscription_edit', { 'id': entity.id, 'idformation':formation.id }) }}">edit</a>
				</td>
            </tr>
        {% endfor %}
        </tbody>
	</table>
</div>
</div>

{# ATTENTES #}
<div id="attentes">
<div class="table-container">
	<table class="table-hovered">
		<thead>
			<tr>
				<th class="statut"></th>
				<th class="insc info"><span>Nom</span></th>
				<th class="insc info"><span>Prénom</span></th>
				<th class="insc attentes"><span>Attentes</span></th>
				<th></th>
			</tr>
		</thead>
		<tbody>
        {% for entity in entities %}
            <tr>
				{% set class = "" %}
				{% if entity.statut == 'en attente' %}
					{% set class = "attente" %}
				{% elseif entity.statut == 'accepté' %}
					{% set class = "valide" %}
				{% elseif entity.statut == 'annulé' %}
					{% set class = "annule" %}
				{% endif %}
				<td class="statut {{class}}">&nbsp;</td>
				
				{% for personne in entity.personnes %}
						{% if personne.type == 'Stagiaire' %}
							<td class="insc info"><span>{{ personne.nom }} ({{ personne.civilite }})</span></td>
							<td class="insc info"><span>{{ personne.prenom }}</span></td>
						{% endif %}
				{% endfor %}
				<td class="insc attentes"><span>{{ entity.attentes|slice(0, 70)}}{% if entity.attentes|length > 70 %}...{% endif %}</span></td>
                <td class="insc actions">
						<a href="{{ path('inscription_show', { 'id': entity.id, 'idformation':formation.id }) }}">show</a>
						<a href="{{ path('inscription_edit', { 'id': entity.id, 'idformation':formation.id }) }}">edit</a>
				</td>
            </tr>
        {% endfor %}
        </tbody>
	</table>
</div>
</div>

{% else %}
	<p class="text-centered"><span class="oi" data-glyph="info"></span> Aucune inscription pour le moment...</p>
	<div class="text-centered">
		<a href="{{ path('inscription_new', { 'idformation': formation.id }) }}" class="btn btn-green btn-big"><span class="oi" data-glyph="plus"></span> Nouvelle inscription</a>
	</div>
{% endif %}

{% endblock %}