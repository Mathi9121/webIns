{% extends "::app.html.twig" %}

{% block stylesheets %}
{{parent()}}
{% stylesheets 
	'@OCIMFormationsBundle/Resources/public/css/formations.css'
	'@OCIMFormationsBundle/Resources/public/css/jquery.nouislider.css'
filter='cssrewrite' %}
	<link rel="stylesheet" type="text/css" charset="UTF-8" media="all" href="{{ asset_url }}"/>
{% endstylesheets %}
{% endblock %}

{% block  javascripts %}
{{parent()}}
{% javascripts
	'@OCIMFormationsBundle/Resources/public/js/Formation/jquery.nouislider.min.js'
	'@OCIMFormationsBundle/Resources/public/js/Formation/filtresFormation.js'
	%}
         <script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
{% endblock %}

{# Titres #}
{% block title %} Formations{% endblock %}
{% block titre %}Toutes les formations{% endblock %}


{# Controls #}
{% block controls %}
<a href="{{ path('formation_new') }}" class="btn btn-green btn-outline"><i class="fa fa-plus"></i>  Nouvelle formation</a>
{% endblock %}

{# CONTENT #}
{% block body  %}


{# listes formations #}
<div class="panel">
	<div class="header">
		<span class="titre">Toutes les formations</span>
			<span class="controls right group">
				<label class="recherche"><i class="fa fa-search"></i><input type="text" class="" placeholder="Rechercher" id="recherche"/></label>
				<a href="#" class="toggleFiltres"><i class="fa fa-filter"></i> Filtrer</a>
			</span>
	</div>
	
	{# filtres #}
	<div class="units-row end units-padding filtres hide">
		<div class="unit-70">
			{# date #}
			<div id="date">
				<div id="datefilter"></div>
				<div id="event-start" class="left"></div>
				<div id="event-end" class="right"></div>
			</div>
		</div>
		<div class="unit-30">
			{# select #}
				<select name="select_multi" id="selectfilter" class="width-100">
					<option value="tous" selected>Tous</option>
					{% for type in types %}
					<option value="{{type.id}}">{{type.type}}</option>
					{% endfor %}
				</select>
		</div>
	</div>

<div class="panel-body">
	<table class="table-hovered width-100">
			<thead>
				<tr>
					<th><i class="fa fa-graduation-cap"></i> Intitulé</th>
					<th><i class="fa fa-map-marker"></i> Lieu</th>
					<th><i class="fa fa-calendar"></i> Dates</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
			{% for formation in formations %}
				<tr class="titre-formation" data-idformation="{{formation.id}}" data-typeformation="{{formation.type.id}}" data-debutstamp="{{ formation.dateDebut|date("U") }}" data-finstamp="{{ formation.dateFin|date("U") }}" data-debut="{{ formation.dateDebut|date("d/m/Y") }}" data-fin="{{ formation.dateFin|date("d/m/Y") }}">
					<td><span class="fa-conteneur"><i class="fa fa-angle-right hide"></i></span>{{ formation.intitule }} <span class="label right" title="Durée de la formation">{{ formation._nbJours }}J</span></td>
					<td>{{ formation.lieu }}</td>
					<td>{{ formation.dateDebut|date("d/m/Y") }}</td>
					<td>
						<div class="group">
							{% set spanclass = '' %}
							{% set text = '' %}
							{% for statut in formation._count %}
								{% if statut.statut == 'en attente' %}
									{% set spanclass = 'badge-yellow' %}
									{% set text = 'Inscriptions en attente de validation' %}
								{% endif %}
								{% if statut.statut == 'accepté' %}
									{% set spanclass = 'badge-green' %}
									{% set text = 'Inscriptions validées' %}
								{% endif %}
								{% if statut.statut == 'annulé' %}
									{% set spanclass = 'badge-red' %}
									{% set text = "Nombre d'inscriptions annulées" %}
								{% endif %}
								<span title="{{ text }}" class="badge {{ spanclass }}">{{ statut.1 }}</span>
							{% endfor %}
						</div>
					</td>
				</tr>
				
				{# details #}
				<tr class="details-formation hide">
					<td colspan="4">
						<div class="units-row">
							
						</div>
						<span class="btn-group">
								<a class="btn small" href="{{ path('inscription', { 'idformation': formation.id }) }}"><i class="fa fa-users"></i><br/>Incriptions</a>
								<a class="btn small" href="{{ path('formation_show', { 'id': formation.id }) }}"><i class="fa fa-info"></i><br/>Détails</a>
								<a class="btn small" href="#"><i class="fa fa-truck"></i><br/>Logistique</a>
								<a class="btn small" href="{{ path('formation_edit', { 'id': formation.id }) }}"><i class="fa fa-pencil"></i><br/>Modifier</a>
							</span>
					</td>
				</tr>
				
			{% endfor %}
			</tbody>
		</table>
	</div>
</div>
{% endblock %}



